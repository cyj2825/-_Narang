<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stomp RabbitMQ Chat</title>
    <!-- stomp.js 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>Stomp RabbitMQ Chat</h1>

<div id="chatArea"></div>

<form id="chatForm">
    <label for="message">Message:</label>
    <input type="text" id="message" required>
    <button type="submit">Send</button>
</form>

<script>
    const sockJS = new SockJS("http://localhost:8080/stomp/chat");
    console.log(sockJS);
    const stomp = Stomp.over(sockJS);

    stomp.connect("guest", "guest", function(frame) {
        console.log("Connected to Stomp");

        // Subscribe to the chat room
        stomp.subscribe("/exchange/chat.exchange/room.1", function(message) {
            const chatArea = document.getElementById("chatArea");
            const chatDto = JSON.parse(message.body);

            const messageDiv = document.createElement("div");
            messageDiv.textContent = `${chatDto.nickname}: ${chatDto.message}`;
            chatArea.appendChild(messageDiv);
        });

    }, function(error) {
        console.error("Stomp connection error", error);
    });

    const chatForm = document.getElementById("chatForm");
    chatForm.addEventListener("submit", function(event) {
        event.preventDefault();

        const messageInput = document.getElementById("message");
        const message = messageInput.value;

        // Send the message to the chat room
        // stomp.send("/pub/chat.message.1", {}, JSON.stringify({
        //     message: message,
        //     memberId: 1,
        //     nickname: "YourNickname"
        // }));

        messageInput.value = "";
    });
</script>
</body>
</html>